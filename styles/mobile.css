/* ===== 모바일 친화적 반응형 스타일 ===== */

/* 터치 디바이스 최적화 */
@media (pointer: coarse) {
  .action-btn,
  .menu-btn,
  .utility-btn,
  .price-btn,
  .building-option,
  .phase-step,
  button {
    min-height: 44px;
    min-width: 44px;
  }
}

/* ===== 태블릿 (max-width: 1024px) ===== */
@media (max-width: 1024px) {
  /* 게임 컨테이너: 사이드바 공간 제거 */
  #game-container {
    padding-left: 1rem !important;
    padding-top: 70px !important;
    padding-right: 1rem !important;
  }

  /* 플레이어 패널: 고정 사이드바 -> 접을 수 있는 패널 */
  #player-panels {
    position: fixed !important;
    top: 0 !important;
    left: -280px !important;
    width: 260px !important;
    height: 100vh !important;
    z-index: 2000 !important;
    background: var(--bg-primary) !important;
    padding: 1rem !important;
    padding-top: 60px !important;
    transition: left 0.3s ease !important;
    box-shadow: 4px 0 20px rgba(0, 0, 0, 0.5) !important;
    flex-direction: column !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
  }

  #player-panels.mobile-open {
    left: 0 !important;
  }

  /* 플레이어 패널 오버레이 */
  .mobile-panel-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    z-index: 1999;
  }

  .mobile-panel-overlay.show {
    display: block;
  }

  /* 헤더 위치 조정 */
  .board-header-sticky {
    left: 0 !important;
    margin-left: 0.5rem !important;
    margin-right: 0.5rem !important;
    padding: 0.4rem 0.8rem !important;
    margin-top: 0 !important;
    border-radius: 0 0 var(--radius-md) var(--radius-md) !important;
  }

  /* 헤더 레이아웃 압축 */
  .header-top-row {
    gap: 0.5rem !important;
    flex-wrap: wrap;
  }

  .round-badge {
    padding: 0.3rem 0.8rem !important;
  }

  .round-badge .round-label {
    font-size: 0.85rem !important;
  }

  .round-badge .round-number {
    font-size: 1rem !important;
  }

  .current-phase-large {
    padding: 0.4rem 1rem !important;
  }

  .current-phase-name {
    font-size: 1rem !important;
  }

  /* 페이즈 진행 표시 압축 */
  .board-header-sticky .phase-step {
    padding: 0.3rem 0.6rem !important;
  }

  .board-header-sticky .phase-step .phase-icon {
    font-size: 1.2rem !important;
  }

  .board-header-sticky .phase-step .phase-name {
    font-size: 0.7rem !important;
  }

  .phase-arrow {
    font-size: 0.8rem !important;
  }

  /* 유틸리티 버튼 조정 */
  #game-utility-buttons {
    top: 0.5rem !important;
    right: 0.5rem !important;
    gap: 0.3rem !important;
  }

  .utility-btn {
    padding: 0.4rem 0.6rem !important;
    font-size: 0.75rem !important;
  }

  /* 카드 그리드 최적화 */
  .card-grid {
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)) !important;
    gap: 0.75rem !important;
  }

  /* 모달 최적화 */
  .design-modal-overlay,
  .construction-modal-overlay {
    padding: 0.5rem !important;
  }

  .design-modal-content,
  .construction-modal-content {
    padding: 1rem !important;
    max-height: 95vh !important;
  }

  .design-modal-content h3,
  .construction-modal-content h3 {
    font-size: 1.3rem !important;
  }

  /* 구매 옵션 패널 */
  #purchase-options {
    left: 0.5rem !important;
    right: 0.5rem !important;
    transform: none !important;
    bottom: 80px !important;
    max-width: none !important;
    width: auto !important;
  }

  .price-options {
    flex-wrap: wrap !important;
  }

  .price-btn {
    min-width: 80px !important;
  }

  /* 알림 위치 조정 */
  #notifications {
    top: 0.5rem !important;
    right: 0.5rem !important;
    left: 0.5rem !important;
  }

  .notification {
    padding: 0.75rem 1rem !important;
    font-size: 0.85rem !important;
  }

  /* 헤더 스페이서 제거 */
  .header-spacer {
    display: none !important;
  }
}

/* ===== 모바일 (max-width: 640px) ===== */
@media (max-width: 640px) {
  html {
    font-size: 14px;
  }

  /* 게임 컨테이너 더 좁은 패딩 */
  #game-container {
    padding: 0.5rem !important;
    padding-top: 65px !important;
  }

  /* 메인 메뉴 */
  .game-logo {
    font-size: 3rem;
  }

  .game-title {
    font-size: 2rem !important;
  }

  .game-subtitle {
    font-size: 0.9rem;
    margin-bottom: 2rem;
  }

  .menu-buttons {
    max-width: 100%;
    padding: 0 1rem;
  }

  /* 플레이어 설정 */
  #player-setup {
    margin: 1rem auto;
    padding: 1rem;
  }

  .setup-header h2 {
    font-size: 1.4rem;
  }

  .setup-actions {
    flex-direction: column;
  }

  /* 헤더 더 압축 */
  .board-header-sticky {
    padding: 0.3rem 0.5rem !important;
  }

  .header-top-row {
    gap: 0.3rem !important;
  }

  .round-badge {
    padding: 0.2rem 0.5rem !important;
  }

  .round-badge .round-label {
    font-size: 0.75rem !important;
  }

  .round-badge .round-number {
    font-size: 0.85rem !important;
  }

  .current-phase-large {
    padding: 0.3rem 0.6rem !important;
  }

  .current-phase-name {
    font-size: 0.85rem !important;
  }

  /* 페이즈 표시: 현재 활성만 보이도록 */
  .phase-step:not(.active) .phase-name {
    display: none !important;
  }

  .phase-step:not(.active) {
    padding: 0.25rem 0.4rem !important;
  }

  .board-header-sticky .phase-step .phase-icon {
    font-size: 1rem !important;
  }

  .phase-arrow {
    font-size: 0.6rem !important;
  }

  /* 현재 플레이어 턴 표시 */
  .current-player-turn {
    padding: 0.2rem 0.5rem !important;
  }

  .current-player-turn .player-turn {
    font-size: 0.8rem !important;
  }

  /* 유틸리티 버튼 */
  #game-utility-buttons {
    top: auto !important;
    bottom: 0 !important;
    right: 0 !important;
    left: 0 !important;
    position: fixed !important;
    justify-content: center !important;
    background: linear-gradient(0deg, var(--bg-primary) 70%, transparent) !important;
    padding: 0.5rem !important;
    padding-bottom: env(safe-area-inset-bottom, 0.5rem) !important;
    z-index: 1001 !important;
    gap: 0.25rem !important;
  }

  .utility-btn {
    flex: 1 !important;
    text-align: center !important;
    padding: 0.5rem 0.3rem !important;
    font-size: 0.7rem !important;
    border-radius: var(--radius-sm) !important;
  }

  /* 하단 유틸리티바를 위한 여백 */
  #game-container {
    padding-bottom: 60px !important;
  }

  /* 카드 그리드 */
  .card-grid {
    grid-template-columns: 1fr !important;
    gap: 0.5rem !important;
  }

  /* 카드 스타일 압축 */
  .game-card {
    padding: 0.75rem !important;
  }

  .card-header {
    font-size: 0.9rem !important;
  }

  /* 액션 버튼 */
  .action-buttons {
    flex-wrap: wrap !important;
    justify-content: center !important;
    gap: 0.5rem !important;
  }

  .action-btn {
    padding: 0.7rem 1rem !important;
    font-size: 0.9rem !important;
    flex: 1;
    min-width: 120px;
  }

  /* 액션 영역 */
  #action-area {
    padding: 0.5rem !important;
    padding-bottom: 60px !important;
  }

  /* 모달 전체 화면화 */
  .result-modal,
  .detail-modal,
  .dialog {
    width: 95% !important;
    max-height: 85vh !important;
    border-radius: var(--radius-lg) !important;
  }

  .modal-header {
    padding: 1rem !important;
  }

  .modal-header h2 {
    font-size: 1.1rem !important;
  }

  .modal-content {
    padding: 1rem !important;
  }

  /* 건물 그리드 */
  .building-grid {
    grid-template-columns: repeat(2, 1fr) !important;
    gap: 0.5rem !important;
  }

  .building-option {
    padding: 0.75rem !important;
  }

  .building-emoji {
    font-size: 1.5rem !important;
  }

  /* 설계/시공 모달 */
  .design-modal-content,
  .construction-modal-content {
    padding: 0.75rem !important;
    border-radius: var(--radius-md) !important;
  }

  .design-modal-content .building-grid {
    grid-template-columns: repeat(2, 1fr) !important;
  }

  /* 시공 디테일 그리드 */
  .detail-grid {
    grid-template-columns: 1fr !important;
  }

  /* 구매 옵션 모바일 전체 너비 */
  #purchase-options {
    bottom: 60px !important;
    left: 0 !important;
    right: 0 !important;
    border-radius: var(--radius-lg) var(--radius-lg) 0 0 !important;
    padding: 1rem !important;
  }

  /* 스크롤 인디케이터 */
  .scroll-indicator {
    bottom: 70px !important;
    padding: 0.5rem 1rem !important;
  }

  .scroll-indicator-text {
    font-size: 0.8rem !important;
  }

  /* 단가표 테이블 */
  .budget-table {
    font-size: 0.7rem !important;
  }

  .budget-table th,
  .budget-table td {
    padding: 0.3rem !important;
  }

  .budget-table .desc-cell {
    display: none !important;
  }

  /* 게임 규칙 모달 */
  .game-manual {
    max-height: 70vh !important;
  }

  .manual-section h3 {
    font-size: 1rem !important;
  }

  .manual-section p,
  .manual-section li {
    font-size: 0.85rem !important;
  }
}

/* ===== 매우 작은 화면 (max-width: 380px) ===== */
@media (max-width: 380px) {
  html {
    font-size: 13px;
  }

  .card-grid {
    grid-template-columns: 1fr !important;
  }

  .building-grid {
    grid-template-columns: 1fr !important;
  }

  .design-modal-content .building-grid {
    grid-template-columns: 1fr !important;
  }

  .phase-step:not(.active) {
    display: none !important;
  }

  .phase-arrow {
    display: none !important;
  }

  .current-phase-large {
    flex: 1;
    justify-content: center;
  }
}

/* ===== 모바일 토글 버튼 (JS로 추가) ===== */
.mobile-player-toggle {
  display: none;
  position: fixed;
  top: 0.5rem;
  left: 0.5rem;
  z-index: 2001;
  width: 40px;
  height: 40px;
  border-radius: var(--radius-md);
  background: var(--bg-tertiary);
  border: 1px solid rgba(255, 255, 255, 0.15);
  color: var(--text-primary);
  font-size: 1.2rem;
  cursor: pointer;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  box-shadow: var(--shadow-md);
}

.mobile-player-toggle:hover {
  background: var(--accent-blue);
}

.mobile-player-toggle.active {
  background: var(--accent-gold);
  color: var(--bg-primary);
}

@media (max-width: 1024px) {
  .mobile-player-toggle {
    display: flex !important;
  }
}

/* ===== 아이소메트릭 맵 모바일 ===== */
@media (max-width: 900px) {
  .iso-city-container {
    grid-template-columns: 1fr !important;
  }

  .iso-city-sidebar {
    max-height: 150px !important;
  }

  .iso-city-map {
    min-height: 250px !important;
  }
}

/* ===== 랜드스케이프 모바일 ===== */
@media (max-height: 500px) and (orientation: landscape) {
  .board-header-sticky {
    padding: 0.2rem 0.5rem !important;
  }

  .phase-progress-row {
    display: none !important;
  }

  .header-top-row {
    gap: 0.3rem !important;
  }

  #game-container {
    padding-top: 45px !important;
  }
}

/* ===== safe area (노치 대응) ===== */
@supports (padding: env(safe-area-inset-top)) {
  @media (max-width: 1024px) {
    .board-header-sticky {
      padding-top: calc(0.4rem + env(safe-area-inset-top)) !important;
    }

    #game-utility-buttons {
      padding-bottom: calc(0.5rem + env(safe-area-inset-bottom)) !important;
    }
  }
}
